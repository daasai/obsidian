这份 **DAAS Alpha v1.3 产品规格说明书 (PRD)** 是基于我们之前的对话、代码重构以及最终的策略优化整理而成的。

它不仅包含了功能定义，还固化了我们在开发过程中确定的**技术架构**和**核心策略参数**。您可以直接将此文档作为 v1.3 的“最终档案”存档，或发给团队成员。

---

# 📄 DAAS Alpha v1.3 产品规格说明书 (Product Spec)

| **属性**   | **内容**                                |
| -------- | ------------------------------------- |
| **产品名称** | DAAS Alpha (Data-Driven Alpha System) |
| **版本号**  | v1.3 (Pro Dashboard Edition)          |
| **文档状态** | ✅ 已定稿 (Final)                         |
| **最后更新** | 2026-01-20                            |
| **核心目标** | 实现从“脚本回测”到“模拟实盘”的闭环；引入 BBI 择时体系。      |

---

## 1. 产品概述 (Overview)

### 1.1 产品愿景

DAAS Alpha v1.3 旨在打造一个**“金融极简风”**的个人量化投资终端。它将原本分散的 Python 脚本整合为一个具备**数据可视化**、**自动化风控**和**模拟交易账本**的全栈应用，帮助用户在 A 股市场执行“动量 + 择时”策略。

### 1.2 核心价值主张 (Value Proposition)

1. **知行合一：** 通过持久化账本 (SQLite)，强制记录每一次交易，解决“回测没输过，实盘没赢过”的问题。
    
2. **自动化风控：** 引入 BBI 多空过滤器，系统性规避熊市主跌浪。
    
3. **极简决策：** 摒弃复杂的金融终端界面，采用 ChatGPT 式的“无限画布”设计，只展示高信噪比信息。
    

---

## 2. 核心策略逻辑 (Strategy Logic)

_这是 v1.3 的“大脑”，所有模块均基于此逻辑运行。_

### 2.1 选股引擎 (The Hunter)

- **核心因子：**
    
    - **RPS (相对强度):** `RPS_20 > 85` (全市场前 15% 强者)。
        
    - **Volume Ratio (量比):** `VR_5 > 1.5` (确认机构资金介入)。
        
- **过滤条件：** 剔除 ST、剔除上市不满 60 天新股。
    

### 2.2 择时引擎 (The BBI Filter)

- **指标定义：** BBI = (MA3 + MA6 + MA12 + MA24) / 4。
    
- **多空判定 (防抖动优化版):**
    
    - **多头 (Bull):** 连续 **3天** 收盘价 > BBI。 -> _允许开新仓。_
        
    - **空头 (Bear):** 任意单日收盘价 < BBI。 -> _禁止开新仓，持有现金。_
        

### 2.3 风控规则 (Risk Control)

- **个股止损：** `(现价 - 成本价) / 成本价 <= -8%` -> 触发卖出信号。
    
- **交易制度：** 严格遵守 A 股 **T+1** 规则（今日买入，明日可用）。
    

---

## 3. 功能模块详解 (Functional Requirements)

### 3.1 🏠 驾驶舱 (Dashboard)

**目标：** “每日早报”，秒级判断市场环境。

- **KPI 卡片：**
    
    - **市场状态:** 显示“🟢 多头 (进攻)”或“🔴 空头 (防守)”。
        
    - **赚钱效应:** 进度条显示 (0-100%)。
        
    - **目标仓位:** 100% 或 0% (基于 BBI)。
        
    - **组合净值:** 实时总资产。
        
- **核心图表:** 上证指数 (000001.SH) K线图叠加 BBI 曲线。
    
    - _交互:_ 鼠标悬停显示具体点位和多空信号。
        

### 3.2 🔭 猎场 (Hunter)

**目标：** “高信噪比信息流”，发现猎物。

- **输入区:** 极简筛选栏 (RPS 阈值滑块, 量比输入框)。
    
- **列表区:** 卡片式/表格展示。
    
    - **RPS 可视化:** 使用 **红色进度条** 展示强度。
        
    - **操作:** “➕” 按钮，点击弹出“快速买入”弹窗。
        
    - **状态:** 已持仓的股票应显示“已持仓”标签。
        

### 3.3 💼 模拟盘 (Portfolio)

**目标：** “数字化账本”，管理持仓。

- **资产看板:** 总资产、可用现金、当日浮盈 (绿色/红色高亮)。
    
- **持仓列表:**
    
    - 字段: 代码、名称、持仓量 (总/可用)、成本、现价、**盈亏比例**。
        
    - **预警:** 盈亏比例 < -6% 时，整行背景泛黄预警。
        
- **交易记录:** 折叠式面板，记录所有历史买卖流水。
    

### 3.4 🧪 实验室 (Lab)

**目标：** “策略风洞”，建立信仰。

- **配置区 (Sidebar):** 动态调整回测时间、RPS 阈值、止损线。
    
- **结果区 (Main):**
    
    - **权益曲线:** 策略净值 vs 基准净值 (Recharts 交互图)。
        
    - **核心指标:** 总回报、年化、最大回撤、胜率。
        
    - **归因分析:** Top 3 盈利股票 vs Top 3 亏损股票 (数据需准确区分正负)。
        

---

## 4. 技术架构 (Technical Architecture)

### 4.1 技术栈 (Stack)

- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS + Zustand (State) + Recharts (Viz).
    
- **Backend:** FastAPI (Python 3.10+).
    
- **Database:** SQLite (单文件部署，易于备份).
    
- **ORM:** SQLAlchemy (为未来迁移 Postgres 预留空间).
    

### 4.2 数据库模型 (Schema)

- `Account`: 记录总资产、现金、市值 (单例模式)。
    
- `Position`: 记录持仓股 (`total_vol`, `avail_vol` 用于 T+1)。
    
- `Order`: 交易流水 (`order_id`, `action`, `price`, `reason`).
    
- `DailyNav`: 每日净值快照 (用于画收益曲线)。
    

### 4.3 自动化任务 (Automation)

- **脚本:** `src/jobs/daily_runner.py`
    
- **执行时间:** 交易日 **17:30** (确保 Tushare 数据就绪)。
    
- **流程:**
    
    1. 同步全市场日线数据。
        
    2. 计算 BBI 及多空信号。
        
    3. **盯市 (Mark-to-Market):** 更新持仓市值，写入 `DailyNav`。
        
    4. **扫描:** 运行 Hunter 策略，生成明日关注池。
        

---

## 5. 数据源与外部依赖 (External Dependencies)

|**依赖项**|**说明**|**备注**|
|---|---|---|
|**Tushare Pro**|主数据源|需 Token，每日 17:00 后数据稳定。|
|**Eastmoney**|备用数据源|用于获取实时行情 (Tick) 或补充财务数据。|
|**Pandas**|数据处理核心|用于 BBI、RPS 的向量化计算。|

---

## 6. 已知限制与未来规划 (Limitations & Roadmap)

### 6.1 当前限制 (v1.3)

- **数据延迟:** 模拟盘采用收盘价或 Tushare 数据，非实时 Tick 级撮合。
    
- **单用户:** 仅支持单账户管理，无多租户权限系统。
    
- **盲目性:** 仅基于价量因子，缺乏对公告、新闻的语义理解。
    

### 6.2 v1.4 规划 (AI Native Preview)

- **LLM 集成:** 引入 DeepSeek/OpenAI API。
    
- **语义因子:** 增加 "News Sentiment" (新闻情绪) 和 "Logic Score" (逻辑评分) 字段。
    
- **智能研报:** 点击股票，AI 自动生成 "Why Buy/Why Sell" 的简报。
    

---

> **附注：** 此 Spec 是开发团队的“宪法”。任何对策略参数（如 RPS 85 改 90）或数据结构（如增加 PostGIS）的修改，均需同步更新此文档。